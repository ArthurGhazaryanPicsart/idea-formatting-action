name: Formatting IDEA

on:
  pull_request:
    types: [ assigned, opened, synchronize, reopened, labeled ]

jobs:
  formatting:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      #      - uses: engineerd/configurator@v0.0.8
      #        with:
      #          name: "intellij"
      #          url: "https://download.jetbrains.com/idea/ideaIU-2021.1.2.tar.gz"
      #          pathInArchive: "idea-IU-211.7442.40/bin/idea.sh"

      - name: Get changed files
        id: changed-files
        uses: tj-actions/changed-files@v9.1
        with:
          separator: " "
      - name: List all added files
        run: |
          echo "${{ steps.changed-files.outputs.all_modified_files }}"
      - name: Get Intellij artifact
        uses: actions/download-artifact@v2
        with:
          name: intellij-artifact
      - name: Download Intellij
        uses: actions/upload-artifact@v2
        if: failure()
        with:
          name: intellij-artifact
          path: ${{ github.workspace }}/idea-IC-211.7442.40
      - name: Testing
        run: |
          if [ -z "${{ steps.changed-files.outputs.all_modified_files }}" ]
          then
              echo "Nothing to format"
          elif [ ! -d "${{ github.workspace }}/idea-IC-211.7442.40" ]
          then
#             rm -rf ideaIC-2021.1.2.tar.gz
             idea_path="${{ github.workspace }}/idea-IC-211.7442.40/bin/idea.sh"
             ${{ github.workspace }}/idea-IC-211.7442.40/bin/idea.sh format ${{ steps.changed-files.outputs.all_modified_files }}
          else
             echo "IDEA exists"
          fi
      - name: Commit files
        run: |
          # if [ -z "$(git diff --name-only HEAD)" ]
          # then
          #  echo "Nothing to format"
          # else
           git config --local user.email "41898282+github-actions[bot]@users.noreply.github.com"
           git config --local user.name "github-actions[bot]"
           git commit -m "Format files with IDEA" -a
          #fi
      - name: Push changes
        uses: ad-m/github-push-action@v0.6.0
        with:
          force: true
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: ${{ github.head_ref }}
